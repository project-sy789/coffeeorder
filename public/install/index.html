<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ติดตั้งระบบ POS คาเฟ่</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background-color: #f8f9fa;
    }
    .card {
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .btn-primary {
      background-color: #6c5ce7;
      border-color: #6c5ce7;
    }
    .btn-primary:hover {
      background-color: #5649c0;
      border-color: #5649c0;
    }
    .header {
      background-color: #6c5ce7;
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
      border-radius: 0 0 10px 10px;
    }
    .step-item {
      padding: 20px;
      border-left: 3px solid #dee2e6;
      position: relative;
      margin-bottom: 20px;
    }
    .step-item.active {
      border-left: 3px solid #6c5ce7;
    }
    .step-item.completed {
      border-left: 3px solid #28a745;
    }
    .step-number {
      display: inline-block;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #dee2e6;
      color: #fff;
      text-align: center;
      line-height: 30px;
      position: absolute;
      left: -16px;
      top: 20px;
    }
    .step-item.active .step-number {
      background-color: #6c5ce7;
    }
    .step-item.completed .step-number {
      background-color: #28a745;
    }
    .step-content {
      margin-left: 20px;
    }
  </style>
</head>
<body>
  <div class="header text-center">
    <h1>ติดตั้งระบบ POS คาเฟ่</h1>
    <p>ระบบจะนำคุณผ่านขั้นตอนการติดตั้งทีละขั้นตอน</p>
  </div>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-header bg-primary text-white">
            <h5>ขั้นตอนการติดตั้ง</h5>
          </div>
          <div class="card-body">
            <div class="step-list">
              <div class="step-item active" id="step1-indicator">
                <div class="step-number">1</div>
                <div class="step-content">
                  <h5>ตรวจสอบความพร้อม</h5>
                </div>
              </div>
              <div class="step-item" id="step2-indicator">
                <div class="step-number">2</div>
                <div class="step-content">
                  <h5>ตั้งค่าฐานข้อมูล</h5>
                </div>
              </div>
              <div class="step-item" id="step3-indicator">
                <div class="step-number">3</div>
                <div class="step-content">
                  <h5>ข้อมูลร้านและผู้ดูแล</h5>
                </div>
              </div>
              <div class="step-item" id="step4-indicator">
                <div class="step-number">4</div>
                <div class="step-content">
                  <h5>เสร็จสิ้น</h5>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header bg-info text-white">
            <h5>มีปัญหา?</h5>
          </div>
          <div class="card-body">
            <p>หากคุณพบปัญหาในการติดตั้ง คุณสามารถ:</p>
            <ul>
              <li>ตรวจสอบข้อกำหนดของระบบ</li>
              <li>ตรวจสอบการเชื่อมต่อฐานข้อมูล</li>
              <li><a href="/auth-fix" class="link-primary">แก้ไขปัญหาการเข้าสู่ระบบ</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <!-- Step 1: ตรวจสอบความพร้อม -->
        <div class="card mb-4" id="step1">
          <div class="card-header bg-primary text-white">
            <h3>ขั้นตอนที่ 1: ตรวจสอบความพร้อม</h3>
          </div>
          <div class="card-body">
            <p>ระบบจะตรวจสอบความพร้อมของเซิร์ฟเวอร์และสภาพแวดล้อมเพื่อให้แน่ใจว่าสามารถติดตั้งได้อย่างสมบูรณ์</p>
            <div id="requirements-results" class="mb-3">
              <div class="d-flex justify-content-center">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">กำลังตรวจสอบ...</span>
                </div>
              </div>
              <p class="text-center mt-2">กำลังตรวจสอบความพร้อมของระบบ...</p>
            </div>
            <button id="check-requirements" class="btn btn-primary d-none">ตรวจสอบอีกครั้ง</button>
            <button id="go-to-step2" class="btn btn-success d-none">ดำเนินการต่อ</button>
          </div>
        </div>

        <!-- Step 2: ตั้งค่าฐานข้อมูล -->
        <div class="card mb-4 d-none" id="step2">
          <div class="card-header bg-primary text-white">
            <h3>ขั้นตอนที่ 2: ตั้งค่าฐานข้อมูล</h3>
          </div>
          <div class="card-body">
            <div id="platform-selection" class="mb-4">
              <h5>เลือกแพลตฟอร์มที่คุณใช้งาน</h5>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="platform" id="platform-hosted" value="hosted" checked>
                <label class="form-check-label" for="platform-hosted">
                  <strong>Render หรือ Railway</strong> (มี DATABASE_URL อัตโนมัติ)
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="platform" id="platform-custom" value="custom">
                <label class="form-check-label" for="platform-custom">
                  <strong>เซิร์ฟเวอร์ส่วนตัวหรือ hosting อื่น ๆ</strong> (ต้องกรอกข้อมูลเชื่อมต่อเอง)
                </label>
              </div>
            </div>

            <!-- แบบฟอร์มสำหรับ Render หรือ Railway -->
            <div id="hosted-form" class="mb-4">
              <div class="alert alert-info">
                <h5>ข้อมูลสำหรับ Render หรือ Railway</h5>
                <p>สำหรับ Render และ Railway ระบบจะใช้ DATABASE_URL ที่มีอยู่แล้วโดยอัตโนมัติ</p>
                <p>หากระบบไม่สามารถเชื่อมต่อได้ ตรวจสอบว่า:</p>
                <ol>
                  <li>คุณได้สร้าง PostgreSQL database ใน dashboard แล้ว</li>
                  <li>Environment variable DATABASE_URL มีค่าถูกต้อง</li>
                </ol>
              </div>
              <div id="hosted-db-test-result" class="alert d-none mb-3"></div>
              <div class="d-flex gap-2">
                <button type="button" id="test-hosted-connection" class="btn btn-info">ทดสอบการเชื่อมต่อ</button>
                <button type="button" id="save-hosted-database" class="btn btn-primary">ดำเนินการต่อ</button>
                <button type="button" id="back-to-step1-hosted" class="btn btn-secondary">ย้อนกลับ</button>
              </div>
            </div>

            <!-- แบบฟอร์มสำหรับเซิร์ฟเวอร์ส่วนตัว -->
            <div id="custom-form" class="d-none">
              <p>กรอกข้อมูลการเชื่อมต่อฐานข้อมูล PostgreSQL ของคุณ</p>
              <form id="database-form">
                <div class="mb-3">
                  <label for="host" class="form-label">โฮสต์</label>
                  <input type="text" class="form-control" id="host" name="host" placeholder="เช่น localhost หรือ db.example.com" required>
                </div>
                <div class="mb-3">
                  <label for="port" class="form-label">พอร์ต</label>
                  <input type="number" class="form-control" id="port" name="port" value="5432" required>
                </div>
                <div class="mb-3">
                  <label for="database" class="form-label">ชื่อฐานข้อมูล</label>
                  <input type="text" class="form-control" id="database" name="database" placeholder="ชื่อฐานข้อมูลของคุณ" required>
                </div>
                <div class="mb-3">
                  <label for="username" class="form-label">ชื่อผู้ใช้</label>
                  <input type="text" class="form-control" id="username" name="username" placeholder="ชื่อผู้ใช้ฐานข้อมูล" required>
                </div>
                <div class="mb-3">
                  <label for="password" class="form-label">รหัสผ่าน</label>
                  <input type="password" class="form-control" id="password" name="password" placeholder="รหัสผ่านฐานข้อมูล" required>
                </div>
                <div id="custom-db-test-result" class="alert d-none mb-3"></div>
                <div class="d-flex gap-2">
                  <button type="button" id="test-custom-connection" class="btn btn-info">ทดสอบการเชื่อมต่อ</button>
                  <button type="submit" id="save-custom-database" class="btn btn-primary">บันทึกและดำเนินการต่อ</button>
                  <button type="button" id="back-to-step1-custom" class="btn btn-secondary">ย้อนกลับ</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Step 3: ข้อมูลร้านและผู้ดูแล -->
        <div class="card mb-4 d-none" id="step3">
          <div class="card-header bg-primary text-white">
            <h3>ขั้นตอนที่ 3: ข้อมูลร้านและผู้ดูแล</h3>
          </div>
          <div class="card-body">
            <p>กรอกข้อมูลเบื้องต้นของร้านและสร้างบัญชีผู้ดูแลระบบ</p>
            <form id="store-form">
              <div class="mb-3">
                <label for="storeName" class="form-label">ชื่อร้าน</label>
                <input type="text" class="form-control" id="storeName" name="storeName" placeholder="ชื่อร้านของคุณ" required>
              </div>
              <hr>
              <h4>ข้อมูลผู้ดูแลระบบ</h4>
              <div class="mb-3">
                <label for="adminName" class="form-label">ชื่อผู้ดูแลระบบ</label>
                <input type="text" class="form-control" id="adminName" name="adminName" placeholder="ชื่อจริง-นามสกุล" required>
              </div>
              <div class="mb-3">
                <label for="adminUsername" class="form-label">ชื่อผู้ใช้</label>
                <input type="text" class="form-control" id="adminUsername" name="adminUsername" placeholder="ชื่อผู้ใช้สำหรับเข้าสู่ระบบ" required>
              </div>
              <div class="mb-3">
                <label for="adminPassword" class="form-label">รหัสผ่าน</label>
                <input type="password" class="form-control" id="adminPassword" name="adminPassword" placeholder="รหัสผ่าน" required>
              </div>
              <div id="store-setup-result" class="alert d-none mb-3"></div>
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="createSampleData">
                <label class="form-check-label" for="createSampleData">
                  สร้างข้อมูลตัวอย่าง (สินค้า, หมวดหมู่, ตัวเลือกการปรับแต่ง)
                </label>
              </div>
              <div class="d-flex gap-2">
                <button type="submit" id="save-store" class="btn btn-primary">บันทึกและดำเนินการต่อ</button>
                <button type="button" id="back-to-step2" class="btn btn-secondary">ย้อนกลับ</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Step 4: เสร็จสิ้น -->
        <div class="card mb-4 d-none" id="step4">
          <div class="card-header bg-success text-white">
            <h3>ขั้นตอนที่ 4: การติดตั้งเสร็จสิ้น</h3>
          </div>
          <div class="card-body text-center">
            <div class="mb-4">
              <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
              <h4 class="mt-3">ติดตั้งระบบสำเร็จแล้ว!</h4>
              <p>คุณสามารถเริ่มต้นใช้งานระบบ POS คาเฟ่ได้ทันที</p>
            </div>
            <div class="card mb-4">
              <div class="card-header bg-info text-white">
                <h5>ข้อมูลการเข้าสู่ระบบ</h5>
              </div>
              <div class="card-body">
                <div id="login-info">
                  <p><strong>URL:</strong> <a href="/" target="_blank">หน้าหลักระบบ</a></p>
                  <p><strong>ชื่อผู้ใช้:</strong> <span id="admin-username">admin</span></p>
                  <p><strong>รหัสผ่าน:</strong> <span id="admin-password">admin123</span></p>
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-center gap-3">
              <a href="/" class="btn btn-primary">ไปยังหน้าหลัก</a>
              <a href="/auth" class="btn btn-success">ไปยังหน้าเข้าสู่ระบบ</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Variables to track the current step
      let currentStep = 1;
      let requirementsSatisfied = false;
      let databaseConfigured = false;
      let storeConfigured = false;

      // Function to switch between steps
      function showStep(step) {
        // Hide all steps
        document.querySelectorAll('[id^="step"]').forEach(el => {
          if (el.id.match(/^step\d+$/)) {
            el.classList.add('d-none');
          }
        });

        // Reset active state on all step indicators
        document.querySelectorAll('[id^="step"][id$="-indicator"]').forEach(el => {
          el.classList.remove('active', 'completed');
        });

        // Show the current step
        document.getElementById(`step${step}`).classList.remove('d-none');
        
        // Update the step indicators
        for (let i = 1; i < step; i++) {
          document.getElementById(`step${i}-indicator`).classList.add('completed');
        }
        document.getElementById(`step${step}-indicator`).classList.add('active');
        
        // Update the current step
        currentStep = step;
      }

      // Check system requirements
      function checkRequirements() {
        const resultsContainer = document.getElementById('requirements-results');
        resultsContainer.innerHTML = `
          <div class="d-flex justify-content-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">กำลังตรวจสอบ...</span>
            </div>
          </div>
          <p class="text-center mt-2">กำลังตรวจสอบความพร้อมของระบบ...</p>
        `;

        fetch('/api/fix-login-error', { 
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        }).then(() => {
          console.log('Fixed login issues if any');
        }).catch(error => {
          console.error('Error fixing login:', error);
        });

        fetch('/api/health')
          .then(response => response.json())
          .then(data => {
            if (data.status === 'ok') {
              resultsContainer.innerHTML = `
                <div class="alert alert-success">
                  <h5><i class="bi bi-check-circle-fill"></i> ระบบพร้อมใช้งาน</h5>
                  <ul>
                    <li>เซิร์ฟเวอร์ใช้งานได้</li>
                    <li>API ทำงานได้ปกติ</li>
                    <li>สามารถดำเนินการติดตั้งต่อไปได้</li>
                  </ul>
                </div>
              `;
              requirementsSatisfied = true;
              document.getElementById('go-to-step2').classList.remove('d-none');
            } else {
              throw new Error('Health check failed');
            }
          })
          .catch(error => {
            resultsContainer.innerHTML = `
              <div class="alert alert-danger">
                <h5><i class="bi bi-exclamation-triangle-fill"></i> พบปัญหาในการตรวจสอบระบบ</h5>
                <p>${error.message || 'ไม่สามารถเชื่อมต่อกับ API ได้'}</p>
                <p>โปรดตรวจสอบว่าเซิร์ฟเวอร์กำลังทำงานอยู่</p>
              </div>
            `;
            document.getElementById('check-requirements').classList.remove('d-none');
          });
      }

      // Test database connection
      function testDatabaseConnection() {
        const host = document.getElementById('host').value;
        const port = document.getElementById('port').value;
        const database = document.getElementById('database').value;
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const resultContainer = document.getElementById('db-test-result');

        if (!host || !port || !database || !username) {
          resultContainer.classList.remove('d-none', 'alert-success');
          resultContainer.classList.add('alert-danger');
          resultContainer.textContent = 'กรุณากรอกข้อมูลให้ครบถ้วน';
          return;
        }

        resultContainer.classList.remove('d-none', 'alert-success', 'alert-danger');
        resultContainer.classList.add('alert-info');
        resultContainer.textContent = 'กำลังทดสอบการเชื่อมต่อ...';

        fetch('/api/db-health', {
          method: 'GET'
        })
          .then(response => response.json())
          .then(data => {
            if (data.status === 'ok') {
              resultContainer.classList.remove('alert-info', 'alert-danger');
              resultContainer.classList.add('alert-success');
              resultContainer.textContent = 'การเชื่อมต่อสำเร็จ! สามารถดำเนินการต่อได้';
            } else {
              resultContainer.classList.remove('alert-info', 'alert-success');
              resultContainer.classList.add('alert-danger');
              resultContainer.textContent = `การเชื่อมต่อล้มเหลว: ${data.message || 'ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้'}`;
            }
          })
          .catch(error => {
            resultContainer.classList.remove('alert-info', 'alert-success');
            resultContainer.classList.add('alert-danger');
            resultContainer.textContent = `เกิดข้อผิดพลาด: ${error.message}`;
          });
      }

      // Setup event listeners
      // เพิ่ม event listeners สำหรับปุ่มหลัก
      document.getElementById('check-requirements').addEventListener('click', checkRequirements);
      document.getElementById('go-to-step2').addEventListener('click', () => showStep(2));
      
      // เพิ่ม event listeners สำหรับปุ่มย้อนกลับของทั้งสองรูปแบบ
      document.getElementById('back-to-step1-hosted').addEventListener('click', () => showStep(1));
      document.getElementById('back-to-step1-custom').addEventListener('click', () => showStep(1));
      document.getElementById('back-to-step2').addEventListener('click', () => showStep(2));
      // ตัวเลือกแพลตฟอร์ม: Render/Railway หรือ Custom
      document.querySelectorAll('input[name="platform"]').forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'hosted') {
            document.getElementById('hosted-form').classList.remove('d-none');
            document.getElementById('custom-form').classList.add('d-none');
          } else {
            document.getElementById('hosted-form').classList.add('d-none');
            document.getElementById('custom-form').classList.remove('d-none');
          }
        });
      });

      // ฟังก์ชันสำหรับทดสอบการเชื่อมต่อฐานข้อมูล Render/Railway
      document.getElementById('test-hosted-connection').addEventListener('click', function() {
        const resultContainer = document.getElementById('hosted-db-test-result');
        resultContainer.classList.remove('d-none', 'alert-success', 'alert-danger');
        resultContainer.classList.add('alert-info');
        resultContainer.textContent = 'กำลังทดสอบการเชื่อมต่อ...';

        fetch('/api/db-health', {
          method: 'GET'
        })
          .then(response => response.json())
          .then(data => {
            if (data.status === 'ok') {
              resultContainer.classList.remove('alert-info', 'alert-danger');
              resultContainer.classList.add('alert-success');
              resultContainer.textContent = 'เชื่อมต่อฐานข้อมูลสำเร็จ! DATABASE_URL ทำงานได้ปกติ';
            } else {
              resultContainer.classList.remove('alert-info', 'alert-success');
              resultContainer.classList.add('alert-danger');
              resultContainer.textContent = `การเชื่อมต่อล้มเหลว: ${data.message || 'ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้'}`;
            }
          })
          .catch(error => {
            resultContainer.classList.remove('alert-info', 'alert-success');
            resultContainer.classList.add('alert-danger');
            resultContainer.textContent = `เกิดข้อผิดพลาด: ${error.message}`;
          });
      });

      // ดำเนินการต่อสำหรับ Render/Railway
      document.getElementById('save-hosted-database').addEventListener('click', function() {
        const resultContainer = document.getElementById('hosted-db-test-result');
        resultContainer.classList.remove('d-none', 'alert-success', 'alert-danger');
        resultContainer.classList.add('alert-info');
        resultContainer.textContent = 'กำลังตรวจสอบและบันทึกการตั้งค่า...';

        // ทดสอบการเชื่อมต่อก่อนดำเนินการต่อ
        fetch('/api/db-health', {
          method: 'GET'
        })
          .then(response => response.json())
          .then(data => {
            if (data.status === 'ok') {
              resultContainer.classList.remove('alert-info', 'alert-danger');
              resultContainer.classList.add('alert-success');
              resultContainer.textContent = 'เชื่อมต่อฐานข้อมูลสำเร็จ! กำลังดำเนินการต่อ...';
              databaseConfigured = true;
              setTimeout(() => showStep(3), 1000);
            } else {
              resultContainer.classList.remove('alert-info', 'alert-success');
              resultContainer.classList.add('alert-danger');
              resultContainer.textContent = `ไม่สามารถดำเนินการต่อได้: ${data.message || 'ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้'} กรุณาตรวจสอบ DATABASE_URL ให้ถูกต้อง`;
            }
          })
          .catch(error => {
            resultContainer.classList.remove('alert-info', 'alert-success');
            resultContainer.classList.add('alert-danger');
            resultContainer.textContent = `เกิดข้อผิดพลาด: ${error.message}`;
          });
      });

      // ฟังก์ชันสำหรับทดสอบการเชื่อมต่อฐานข้อมูล Custom
      document.getElementById('test-custom-connection').addEventListener('click', function() {
        const host = document.getElementById('host').value;
        const port = document.getElementById('port').value;
        const database = document.getElementById('database').value;
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const resultContainer = document.getElementById('custom-db-test-result');

        if (!host || !port || !database || !username) {
          resultContainer.classList.remove('d-none', 'alert-success');
          resultContainer.classList.add('alert-danger');
          resultContainer.textContent = 'กรุณากรอกข้อมูลให้ครบถ้วน';
          return;
        }

        resultContainer.classList.remove('d-none', 'alert-success', 'alert-danger');
        resultContainer.classList.add('alert-info');
        resultContainer.textContent = 'กำลังทดสอบการเชื่อมต่อ...';

        // ส่งข้อมูลไปทดสอบการเชื่อมต่อ (สมมติว่ามี API endpoint นี้)
        fetch('/api/test-db-connection', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            host,
            port,
            database,
            username,
            password
          })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              resultContainer.classList.remove('alert-info', 'alert-danger');
              resultContainer.classList.add('alert-success');
              resultContainer.textContent = 'การเชื่อมต่อสำเร็จ! สามารถดำเนินการต่อได้';
            } else {
              resultContainer.classList.remove('alert-info', 'alert-success');
              resultContainer.classList.add('alert-danger');
              resultContainer.textContent = `การเชื่อมต่อล้มเหลว: ${data.message || 'ไม่สามารถเชื่อมต่อกับฐานข้อมูลได้'}`;
            }
          })
          .catch(error => {
            resultContainer.classList.remove('alert-info', 'alert-success');
            resultContainer.classList.add('alert-danger');
            resultContainer.textContent = `เกิดข้อผิดพลาด: ${error.message}`;
          });
      });

      // บันทึกการตั้งค่าฐานข้อมูล Custom
      document.getElementById('database-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const resultContainer = document.getElementById('custom-db-test-result');
        resultContainer.classList.remove('d-none', 'alert-success', 'alert-danger');
        resultContainer.classList.add('alert-info');
        resultContainer.textContent = 'กำลังบันทึกการตั้งค่า...';

        const host = document.getElementById('host').value;
        const port = document.getElementById('port').value;
        const database = document.getElementById('database').value;
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        // ส่งข้อมูลไปบันทึก (สมมติว่ามี API endpoint นี้)
        fetch('/api/save-db-connection', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            host,
            port,
            database,
            username,
            password
          })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              resultContainer.classList.remove('alert-info', 'alert-danger');
              resultContainer.classList.add('alert-success');
              resultContainer.textContent = 'บันทึกการตั้งค่าฐานข้อมูลเรียบร้อยแล้ว';
              databaseConfigured = true;
              setTimeout(() => showStep(3), 1000);
            } else {
              resultContainer.classList.remove('alert-info', 'alert-success');
              resultContainer.classList.add('alert-danger');
              resultContainer.textContent = `ไม่สามารถบันทึกการตั้งค่า: ${data.message}`;
            }
          })
          .catch(error => {
            resultContainer.classList.remove('alert-info', 'alert-success');
            resultContainer.classList.add('alert-danger');
            resultContainer.textContent = `เกิดข้อผิดพลาด: ${error.message}`;
          });
      });

      // Store form submission
      document.getElementById('store-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const resultContainer = document.getElementById('store-setup-result');
        resultContainer.classList.remove('d-none', 'alert-success', 'alert-danger');
        resultContainer.classList.add('alert-info');
        resultContainer.textContent = 'กำลังบันทึกข้อมูล...';

        const storeName = document.getElementById('storeName').value;
        const adminName = document.getElementById('adminName').value;
        const adminUsername = document.getElementById('adminUsername').value;
        const adminPassword = document.getElementById('adminPassword').value;
        const createSampleData = document.getElementById('createSampleData').checked;

        // Pretend to save store and admin information
        setTimeout(() => {
          // Update login info in the success step
          document.getElementById('admin-username').textContent = adminUsername;
          document.getElementById('admin-password').textContent = adminPassword;

          resultContainer.classList.remove('alert-info', 'alert-danger');
          resultContainer.classList.add('alert-success');
          resultContainer.textContent = 'บันทึกข้อมูลร้านและผู้ดูแลระบบเรียบร้อยแล้ว';
          storeConfigured = true;
          setTimeout(() => showStep(4), 1000);
        }, 1500);
      });

      // Start the installation process
      checkRequirements();
    });
  </script>
</body>
</html>